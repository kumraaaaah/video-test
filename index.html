<script>
  AFRAME.registerComponent("custom-gesture-handler", {
    schema: {
      enabled: { default: true },
    },

    init: function () {
      this.handleScale = this.handleScale.bind(this);
      this.handleRotation = this.handleRotation.bind(this);

      this.scaleFactor = 1;
      this.rotationFactor = 0;
    },

    handleScale: function (event) {
      if (!this.data.enabled) return;
      const el = this.el;

      // make scaling smoother and natural
      this.scaleFactor *= event.detail.scaleChange;
      this.scaleFactor = Math.min(Math.max(this.scaleFactor, 0.5), 3); // clamp between 0.5x and 3x

      el.setAttribute("scale", {
        x: this.scaleFactor,
        y: this.scaleFactor,
        z: this.scaleFactor,
      });
    },

    handleRotation: function (event) {
      if (!this.data.enabled) return;
      const el = this.el;

      // flip the rotation direction to feel natural
      this.rotationFactor += -event.detail.angleChange; 

      el.setAttribute("rotation", {
        x: 0,
        y: this.rotationFactor,
        z: 0,
      });
    },

    play: function () {
      this.el.sceneEl.addEventListener("onefingermove", this.handleRotation);
      this.el.sceneEl.addEventListener("twofingermove", this.handleScale);
    },

    pause: function () {
      this.el.sceneEl.removeEventListener("onefingermove", this.handleRotation);
      this.el.sceneEl.removeEventListener("twofingermove", this.handleScale);
    },
  });
</script>
