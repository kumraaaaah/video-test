<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AR marker â†’ persistent video w/ gestures (fixed scale)</title>

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>

    <!-- AR.js A-Frame build -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

    <!-- gesture-detector (emits onefinger*/twofinger* events for touch) -->
    <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>

    <!-- custom gesture handler (robust) -->
    <script>
      (function () {
        AFRAME.registerComponent("custom-gesture-handler", {
          schema: {
            enabled: { type: "boolean", default: true },
            minScale: { type: "number", default: 0.3 },
            maxScale: { type: "number", default: 5 },
            rotateSensitivity: { type: "number", default: 0.6 }
          },

          init: function () {
            this.sceneEl = this.el.sceneEl || document.querySelector("a-scene");
            this._onOneStart = this._onOneStart.bind(this);
            this._onOneMove = this._onOneMove.bind(this);
            this._onOneEnd = this._onOneEnd.bind(this);
            this._onTwoStart = this._onTwoStart.bind(this);
            this._onTwoMove = this._onTwoMove.bind(this);
            this._onTwoEnd = this._onTwoEnd.bind(this);

            this.isOne = false;
            this.isTwo = false;

            const s = this.el.object3D && this.el.object3D.scale ? this.el.object3D.scale : null;
            this.currentScale = s ? s.x : 1;
            this.startSpread = null;
            this.startAngle = null;
            this.startScale = this.currentScale;
            this.startRotationYDeg = this._getRotationYDeg();

            this.lastOneX = null;
            this.oneStartRotY = this._getRotationYDeg();
          },

          play: function () {
            if (!this.sceneEl) return;
            this.sceneEl.addEventListener("onefingerstart", this._onOneStart);
            this.sceneEl.addEventListener("onefingermove", this._onOneMove);
            this.sceneEl.addEventListener("onefingerend", this._onOneEnd);
            this.sceneEl.addEventListener("twofingerstart", this._onTwoStart);
            this.sceneEl.addEventListener("twofingermove", this._onTwoMove);
            this.sceneEl.addEventListener("twofingerend", this._onTwoEnd);
          },

          pause: function () {
            if (!this.sceneEl) return;
            this.sceneEl.removeEventListener("onefingerstart", this._onOneStart);
            this.sceneEl.removeEventListener("onefingermove", this._onOneMove);
            this.sceneEl.removeEventListener("onefingerend", this._onOneEnd);
            this.sceneEl.removeEventListener("twofingerstart", this._onTwoStart);
            this.sceneEl.removeEventListener("two
