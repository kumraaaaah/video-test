<head>
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
  <!-- must be loaded so gestures fire -->
  <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>

  <!-- custom handler -->
  <script>
    AFRAME.registerComponent("custom-gesture-handler", {
      schema: { enabled: { default: true } },
      init: function () {
        this.handleScale = this.handleScale.bind(this);
        this.handleRotation = this.handleRotation.bind(this);
        this.scaleFactor = 1;
        this.rotationFactor = 0;
      },
      handleScale: function (event) {
        if (!this.data.enabled) return;
        this.scaleFactor *= event.detail.scaleChange;
        this.scaleFactor = Math.min(Math.max(this.scaleFactor, 0.5), 3);
        this.el.setAttribute("scale", {
          x: this.scaleFactor,
          y: this.scaleFactor,
          z: this.scaleFactor,
        });
      },
      handleRotation: function (event) {
        if (!this.data.enabled) return;
        this.rotationFactor += -event.detail.angleChange;
        this.el.setAttribute("rotation", {
          x: 0,
          y: this.rotationFactor,
          z: 0,
        });
      },
      play: function () {
        this.el.sceneEl.addEventListener("onefingermove", this.handleRotation);
        this.el.sceneEl.addEventListener("twofingermove", this.handleScale);
      },
      pause: function () {
        this.el.sceneEl.removeEventListener("onefingermove", this.handleRotation);
        this.el.sceneEl.removeEventListener("twofingermove", this.handleScale);
      },
    });
  </script>
</head>
